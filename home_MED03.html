<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>قسم الطب</title>

   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
   <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

   <style>
      /* --- :root | المتغيرات العامة --- */
      :root {
         --primary-color: #00897b;
         --primary-dark: #00695c;
         --bg-body: #f1f5f9;
         --bg-card: #ffffff;
         --text-primary: #1e293b;
         --text-secondary: #64748b;
         --border-color: #e2e8f0;
         --white: #ffffff;
         --red: #ef4444;
         --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
         --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
         --radius: 0.8rem;
      }
      
      body.dark-mode {
         --bg-body: #0f172a;
         --bg-card: #1e293b;
         --text-primary: #f1f5f9;
         --text-secondary: #94a3b8;
         --border-color: #334155;
      }

      * {
         font-family: 'Cairo', sans-serif;
         margin: 0; padding: 0;
         box-sizing: border-box;
         outline: none; border: none;
         text-decoration: none;
      }
      
      html { font-size: 62.5%; overflow-x: hidden; }
      body { background-color: var(--bg-body); color: var(--text-primary); transition: background-color .3s, color .3s; padding-top: 8rem; }

      .header { background-color: var(--bg-card); padding: 1.5rem 3%; position: fixed; top: 0; right: 0; left: 0; z-index: 1000; box-shadow: var(--shadow-md); border-bottom: 1px solid var(--border-color); }
      .header .flex { display: flex; align-items: center; justify-content: space-between; gap: 2rem; }
      .logo { display: flex; align-items: center; gap: 8px; font-size: 2.2rem; font-weight: 700; color: var(--primary-color); }
      .logo .subtitle { font-size: 1.2rem; line-height: 1.4; text-align: right; }
      .header .icons { display: flex; align-items: center; gap: .5rem; position: relative; }
      .icon-btn { font-size: 2rem; color: var(--text-secondary); cursor: pointer; height: 4.5rem; width: 4.5rem; line-height: 4.5rem; text-align: center; border-radius: 50%; transition: all .2s ease-in-out; }
      .icon-btn:hover { background-color: var(--bg-body); color: var(--primary-color); }
      
      .profile-dropdown { position: absolute; top: calc(100% + 1rem); left: 0; background-color: var(--bg-card); border-radius: var(--radius); box-shadow: var(--shadow-md); border: 1px solid var(--border-color); width: 30rem; padding: 2rem; display: flex; flex-direction: column; align-items: center; gap: 1.5rem; opacity: 0; transform: translateY(-10px); visibility: hidden; transition: all .2s ease-in-out; z-index: 1100; }
      .profile-dropdown.active { opacity: 1; transform: translateY(0); visibility: visible; }
      .profile-dropdown .image { width: 8rem; height: 8rem; border-radius: 50%; object-fit: cover; }
      .profile-dropdown .name { font-size: 1.8rem; color: var(--text-primary); font-weight: 600; }
      .profile-dropdown .role { font-size: 1.4rem; color: var(--text-secondary); }
      
      .btn { width: 100%; padding: 1.2rem; background-color: var(--primary-color); color: var(--white); border-radius: var(--radius); cursor: pointer; font-size: 1.6rem; text-align: center; transition: background-color .2s; }
      .btn:hover { background-color: var(--primary-dark); }
      .btn.logout { background-color: var(--red); }

      .side-bar { position: fixed; top: 0; right: -100%; width: 32rem; max-width: 90%; height: 100vh; background-color: var(--bg-card); border-left: 1px solid var(--border-color); z-index: 1200; transition: right 0.3s ease-in-out; display: flex; flex-direction: column; }
      .side-bar.active { right: 0; }
      .side-bar .close-btn-container { padding: 1.5rem; text-align: left; flex-shrink: 0; }
      #close-btn { font-size: 2.5rem; }
      .side-bar .navbar { padding-top: 1rem; flex-grow: 1; overflow-y: auto; }
      .side-bar .navbar a { display: flex; align-items: center; gap: 2rem; padding: 1.5rem 2rem; font-size: 1.7rem; color: var(--text-secondary); transition: all .2s; }
      .side-bar .navbar a:hover { background-color: var(--bg-body); color: var(--primary-color); padding-right: 2.5rem; }
      .side-bar .navbar a i { font-size: 2rem; width: 2.5rem; text-align: center; }
      
      main { padding: 2rem 3%; }
      .dashboard-title { font-size: 2.8rem; font-weight: 700; margin-bottom: 2rem; color: var(--text-primary); }
      
      .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 999; opacity: 0; visibility: hidden; transition: opacity 0.3s ease; }
      .overlay.active { opacity: 1; visibility: visible; }
      
      /* --- تنسيقات لوحة التحديثات --- */
      .update-card { background-color: var(--bg-card); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: var(--radius); padding: 2rem; margin: 2rem 0; box-shadow: var(--shadow-sm); }
      .update-card h3 { margin-top: 0; margin-bottom: 1.5rem; font-size: 2rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; }
      .update-card ul { list-style: none; padding: 0; margin: 0; }
      .update-card li { display: block; border-bottom: 1px solid var(--border-color); }
      .update-card li:last-child { border-bottom: none; }
      .update-card li a { display: flex; align-items: center; gap: 1.5rem; padding: 1.2rem .5rem; text-decoration: none; color: inherit; transition: background-color 0.2s ease; border-radius: .5rem; }
      .update-card li a:hover { background-color: var(--bg-body); }
      .update-card li i { font-size: 1.8rem; color: var(--primary-color); }
      .update-card li p { margin: 0; line-height: 1.5; font-size: 1.5rem; }
      
      @media (max-width: 450px) {
         html { font-size: 55%; }
         .logo { font-size: 2rem; }
      }
   </style>
</head>
<body>

<div class="overlay"></div>

<header class="header">
   <section class="flex">
      <a href="home_MED03.html" class="logo" onclick="location.reload(); return false;">
         <span class="main-title">أداة علم</span>
         <span class="subtitle">للثالثة<br>طب</span>
      </a>      
      <div class="icons">
         <div id="toggle-btn" class="icon-btn fas fa-sun" title="الوضع"></div>
         <div id="danger-btn" class="icon-btn fas fa-exclamation-triangle" title="تحذير"></div>
         
         <div id="notification-widget-container"></div>
         
         <div id="user-btn" class="fas fa-user icon-btn" title="الملف الشخصي"></div>
         <div id="menu-btn" class="fas fa-bars icon-btn" title="القائمة"></div>

         <div class="profile-dropdown">
            <img src="S22MCS PARTS/قسم الطب.jpg" class="image" alt="صورة القسم">
            <h3 class="name">قسم السنة الثالثة طب</h3>
            <p class="role">تسجيل الخروج سيقودك لصفحة السنوات</p>
            <a href="MED02_profile.html" class="btn">عرض الملف الشخصي</a>
            <a href="adatealm_med_intro.html" id="logout-btn" class="btn logout">تسجيل الخروج</a>
         </div>
      </div>
   </section>
</header>

<aside class="side-bar">
   <div class="close-btn-container">
      <div id="close-btn" class="fas fa-times icon-btn"></div>
   </div>
   <nav class="navbar">
      <a href="home_MED03.html"><i class="fas fa-home"></i><span>الرئيسية</span></a>
    
    
    
    
      
<a href="BOREDTAZASLTIB.htm"class="TAWASLE_ADAT_TAHDITAT_MED02-btn" id="TAWASLE_ADAT_TAHDITAT_MED02Btn" data-count="3" onclick="TAWASLE_ADAT_TAHDITAT_MED02_togglePopup()">
    <i class="fas fa-sync-alt"></i>
    <span >التحديثات والإشعارات</span></a>
  <a href="MED03_BANK_دروس.html"><i class="fas fa-chalkboard-user"></i><span>بنك الدروس</span></a>

    <a href="MED03_BANK_EXAM.html"><i class="fas fa-file-alt"></i><span>بنك الاختبارات</span></a>
  <a href="#"><i class="fas fa-project-diagram"></i><span>بنك الخرائط الذهنية   </span></a>
<a href="#"><i class="fas fa-clone"></i><span>بنك بطاقات الذاكرة</span></a>

  <a href="JADAWL_01MED.html"><i class="fas fa-clipboard-list"></i><span>جداول المراجعة</span></a>
  <a href="TAHLIL_EXAMA_MED01.html"><i class="fas fa-chart-line"></i><span>تحليل الأسئلة</span></a>
  <a href="DRIVER_MED01.html"><i class="fas fa-folder"></i><span>الدرايفات</span></a>
  <a href="KAM_BAKIYA_LI.html"><i class="fas fa-stopwatch"></i><span>عداد اختبارك (كم بقي لك)</span></a>



<a href="#" class="alert-btn" onclick="toggleModal()" aria-label="فتح نافذة التنبيه الطبي">
    <i class="fas fa-exclamation-triangle"></i>
    <span>   زر الخطر مهم لكل مسلم ومسلمة
      </span>
</a>


<a href="ٱخْتِمْ قُرْآنَكَ يَشْفَعْ لَكَ.html"> <i class="fas fa-quran"></i>  <span>     وردك اليومي من القران الكريم 
    (ٱخْتِمْ قُرْآنَكَ يَشْفَعْ لَكَ) 
 </span> </a>

    <a href="اِقْرَأْ أَذْكَارَكَ تَشْفَعْ لَكَ.html"><i class="fas fa-praying-hands"></i><span> 
          زر الاتستغفار  والتسبيح
        (اِقْرَأْ أَذْكَارَكَ تَشْفَعْ لَكَ )
        
      </span></a>



  
<a href="BOREDTAZASLTIB.htm"class="TAWASLE_ADAT_TAHDITAT_MED02-btn" id="TAWASLE_ADAT_TAHDITAT_MED02Btn" data-count="3" onclick="TAWASLE_ADAT_TAHDITAT_MED02_togglePopup()">
    <i class="fas fa-sync-alt"></i>
    <span >التحديثات والإشعارات</span></a>



    <a href="WAJIBATI_ADAT_EALM.html">  <i class="fas fa-clipboard-check"></i> <span>واجباتي    (دون مهامك اليومية كي لا تنساها )  </span> </a>





<a href="TBR3_BLDAM.html"><i class="fas fa-tint"></i><span>  التبرع بالدم     (أداة شفاء)</span></a>





    
    

      <a href="#"><i class="fas fa-user-tie"></i><span>مشرفونا</span></a>



<a href="TBR3_BLDAM.html"><i class="fas fa-tint"></i><span>  التبرع بالدم     (أداة شفاء)</span></a>
    <a href="s22market.html"><i class="fas fa-store" style="color: rgb(251, 200, 34);"></i><span>متجر طلبة الـ 22 (S22MARKET)</span></a>
      <a href="DA3MONA_ADATEALM.html"><i class="fas fa-hands-helping"></i><span>دعمنا</span></a>
      <a href="TAWASLE_ADAT_EALM_KISM_EL_TIB.html" class="medical-alert-btn" aria-label="فتح صفحة تواصل معنا"><i class="fas fa-headset"></i><span>تواصل معنا</span></a>

    
    </nav>
</aside>



































<main>
   <h1 class="dashboard-title">لوحة التحكم الرئيسية</h1>
   
 




<!-- بطاقة دعوية - متجاوبة مع جميع الشاشات -->
<div style="box-sizing: border-box; max-width: 95%; margin: 20px auto; background-color: #1a1a1a; color: #ffffff; padding: 24px; border-radius: 18px; box-shadow: 0 8px 18px rgba(0,0,0,0.5); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.8; border: 1px solid #333;">
  <h2 style="color: #00e676; font-size: 1.5rem; text-align: center; margin-bottom: 20px;">
    🌟 تذكير مهم لكل طالب وطالبة 🌟
  </h2>

  <p style="font-size: 1.15rem; text-align: center; margin-bottom: 18px;">
    إلى جانب دراستك لا تنسَ <strong style="color: #81d4fa;">وردك القرآني اليومي</strong> ما لم تكن على جنابة.
  </p>

  <p style="font-size: 1.15rem; text-align: center; margin-bottom: 18px;">
    ولا تنسَ <strong style="color: #ffd54f;">أذكارك اليومية</strong>، فإنك ولو كنت جنبًا تستطيع الذكر.
  </p>

  <!-- فتوى ابن باز -->
  <div style="background-color: #263238; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
    <p style="font-size: 1rem; text-align: center; color: #cfd8dc; margin-bottom: 10px;">
      📌 <strong>من فتاوى ابن باز رحمه الله:</strong><br>
      هل يجوز الذكر عند طبخ الطعام، وعند الأكل وهو جنب؟
    </p>
    <blockquote style="font-size: 0.95rem; color: #e0f7fa; font-style: italic; text-align: center;">
      "يسمّي الله، ولو كان جنبًا، بس لا يقرأ القرآن حتى يغتسل، أما أن يقول: بسم الله، أو يقول: لا إله إلا الله، وسبحان الله، هذا طيب، ولو جنبًا. النبي ﷺ كان يذكر الله على كل أحيانه."
    </blockquote>



    
  <p style="font-size: 0.9rem; text-align: center; margin-top: 15px;">
    🔗 <a href="https://binbaz.org.sa/fatwas/2891/%D8%AD%D9%83%D9%85-%D8%A7%D9%84%D8%B0%D9%83%D8%B1-%D9%88%D9%82%D8%B1%D8%A7%D8%A9-%D8%A7%D9%84%D9%82%D8%B1%D8%A7%D9%86-%D9%84%D9%84%D8%AC%D9%86%D8%A8" target="_blank" style="color: #4dd0e1; text-decoration: none; font-weight: bold;">
      مصدر الفتوى: موقع ابن باز الرسمي
    </a>
  </p>
  </div>

  <!-- فتوى اسلام ويب -->
  <div style="background-color: #212121; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
    <p style="font-size: 1rem; color: #cfd8dc; text-align: center; margin-bottom: 10px;">
      📚 <strong>من إسلام ويب:</strong><br>
      <em>السؤال:</em> هل يجوز الصلاة على النبي صلى الله عليه وسلم أو القيام ببعض الأذكار والإنسان على جنابة أم هو محرم؟
    </p>
    <blockquote style="font-size: 0.95rem; color: #ffecb3; font-style: italic; text-align: justify;">
      الحمد لله، والصلاة والسلام على رسول الله، وعلى آله وصحبه، أما بعد:<br><br>

      فإن الأفضل والأكمل للمسلم إذا أراد الصلاة على النبي صلى الله عليه وسلم أو قراءة الأذكار والأدعية .. أن يكون على طهارة كاملة وهيئة حسنة، لكن لا مانع من أن يصلي على النبي صلى الله عليه وسلم، ويذكر الله تعالى ويدعوه وهو جنب أو حائض أو محدث حدثاً أصغر أو على أي هيئة كان.
      <br><br>
      لقوله تعالى في وصف عباده أولي الألباب: <strong style="color:#81d4fa;">(الَّذِينَ يَذْكُرُونَ اللَّهَ قِيَاماً وَقُعُوداً وَعَلَى جُنُوبِهِم)</strong> [آل عمران: 191].
      <br><br>
      ولما في الصحيحين عن عائشة رضي الله عنها قالت: <em>كان النبي صلى الله عليه وسلم يذكر الله على كل أحيانه.</em>
      <br><br>
      إلا إذا كان هذا الذكر قرآناً فإنه لا يجوز ذلك في حالة الجنابة على الصحيح، لما رواه أحمد وأصحاب السنن عن علي رضي الله عنه قال: <em>كان رسول الله صلى الله عليه وسلم يقرئنا القرآن ما لم يكن جنباً.</em>
      <br><br>
      <strong>والله أعلم.</strong>
    </blockquote>

    
  <p style="font-size: 0.9rem; text-align: center; margin-top: 15px;">
    🔗 <a href="https://www.islamweb.net/ar/fatwa/21745/%D9%84%D8%A7-%D8%A8%D8%A3%D8%B3-%D8%A8%D8%A7%D9%84%D8%B0%D9%83%D8%B1-%D8%B9%D9%84%D9%89-%D9%83%D9%84-%D8%AD%D9%8A%D9%86" target="_blank" style="color: #4dd0e1; text-decoration: none; font-weight: bold;">
      مصدر الفتوى: إسلام ويب
    </a>
  </div>

  <p style="font-size: 1rem; text-align: center; color: #9e9e9e;">
    اجعل لسانك رطبًا بذكر الله، فهو نورٌ لك في الدنيا والآخرة 🌿
  </p>
</div>




<!-- بطاقة القناة الرسمية - متجاوبة لكل الشاشات -->
<div style="box-sizing: border-box; max-width: 95%; margin: 20px auto; background-color: #121212; color: #ffffff; padding: 20px; border-radius: 16px; box-shadow: 0 6px 16px rgba(0,0,0,0.4); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.7; border: 1px solid #2a2a2a;">
  <h3 style="margin-bottom: 15px; color: #00e5ff; font-size: 1.3rem; text-align: center;">
    📢 القناة الرسمية لـ <span style="color: #80deea;">طلبة الحل الطبي العلاجي
(ط.ح.ط.ع)  </span>
  </h3>
  <p style="margin-bottom: 12px; font-size: 1rem; text-align: center;">
    ندعوك للانضمام إلى القناة الرسمية على تيليجرام من خلال الرابط التالي:
  </p>
  <p style="margin-bottom: 15px; text-align: center;">
    <a href="https://t.me/S22MCS" target="_blank" style="display: inline-block; padding: 10px 15px; background-color: #00bcd4; color: #fff; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 0.95rem; transition: background-color 0.3s;">
      🔗 انضم الآن إلى القناة
    </a>
  </p>
  <p style="font-size: 0.9rem; color: #cfd8dc; text-align: center;">
    ✅ لا تفوّت أي منشور، فالقناة تنشر محتوى توعوي هام ومفيد باستمرار.
  </p>
</div>






   <div class="update-card">
      <h3>📢 آخر التحديثات</h3>
      <ul id="updates-list">
         <li>جارٍ التحميل...</li>
      </ul>
   </div>
</main>

<script type="module">
    // --- S22MCS Notification Widget ---
    (function() {
        const WIDGET_CONFIG = {
            firebaseConfig: {
                apiKey: "AIzaSyAJK6IUSw2YbwNVfB_hRNsOFeO08LEp4c8",
                authDomain: "adatealm-nofication.firebaseapp.com",
                projectId: "adatealm-nofication",
                storageBucket: "adatealm-nofication.firebasestorage.app",
                messagingSenderId: "216068965336",
                appId: "1:216068965336:web:310c95e8e9fc4561cbe8ad",
            },
            targetHeaderContainerId: 'notification-widget-container', // ID الحاوية في الهيدر
            targetUpdatesListId: 'updates-list', // ID قائمة التحديثات في الصفحة
            collectionName: 'notifications',
            maxNotificationsToShow: 15,
            localStorageKey: 's22mcs_last_notif_seen_timestamp'
        };

        const styles = `
            .Tawasle-Notif-Icon-Btn{font-size:2rem;cursor:pointer;position:relative;height:4.5rem;width:4.5rem;line-height:4.5rem;text-align:center;border-radius:50%;transition:all .2s ease-in-out;color:var(--text-secondary,#64748b)}.Tawasle-Notif-Icon-Btn:hover{background-color:var(--bg-body,#f1f5f9);color:var(--primary-color,#00897b)}
            .Tawasle-Notif-Count{position:absolute;top:5px;right:5px;background-color:red;color:white;border-radius:50%;width:18px;height:18px;font-size:11px;font-weight:bold;display:none;justify-content:center;align-items:center;border:1px solid var(--bg-card, #fff)}
            .Tawasle-Notif-Dropdown{display:none;position:absolute;top:calc(100% + 10px);left:0;background-color:var(--bg-card,#fff);border-radius:.8rem;width:320px;max-width:90vw;max-height:450px;overflow-y:auto;box-shadow:var(--shadow-md, 0 4px 6px -1px rgba(0,0,0,0.1));z-index:1001;border:1px solid var(--border-color, #e2e8f0);opacity:0;transform:translateY(10px);transition:opacity .2s ease,transform .2s ease}
            .Tawasle-Notif-Dropdown.Tawasle-Notif-Dropdown-Show{display:block;opacity:1;transform:translateY(0)}
            .Tawasle-Notif-Item{padding:12px 15px;border-bottom:1px solid var(--border-color,#e2e8f0);display:block;transition:background-color .2s ease}
            .Tawasle-Notif-Item:hover{background-color:var(--bg-body,#f1f5f9)}
            .Tawasle-Notif-Item:last-child{border-bottom:none}
            .Tawasle-Notif-Item a{text-decoration:none;color:inherit;display:flex;align-items:center;gap:12px;width:100%;font-size:1.4rem;color:var(--text-secondary,#64748b)}
            .Tawasle-Notif-Item a i{color:var(--primary-color,#00897b)}
            .Tawasle-Notif-Item a p{margin:0;line-height:1.4;color:var(--text-primary,#1e293b)}
        `;

        const widgetHTML = `
            <div id="Tawasle-Notif-Btn" class="Tawasle-Notif-Icon-Btn fas fa-bell" title="الإشعارات">
                <span id="Tawasle-Notif-Count" class="Tawasle-Notif-Count"></span>
            </div>
            <div id="Tawasle-Notif-Menu" class="Tawasle-Notif-Dropdown"></div>
        `;

        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById(WIDGET_CONFIG.targetHeaderContainerId);
            if (!container) {
                console.error('Notification widget container not found!');
                return;
            }

            const styleSheet = document.createElement("style");
            styleSheet.innerText = styles;
            document.head.appendChild(styleSheet);

            container.innerHTML = widgetHTML;
            container.style.position = 'relative';

            const notifBtn = document.getElementById('Tawasle-Notif-Btn');
            const notifMenu = document.getElementById('Tawasle-Notif-Menu');
            const notifCountSpan = document.getElementById('Tawasle-Notif-Count');
            const updatesListContainer = document.getElementById(WIDGET_CONFIG.targetUpdatesListId);

            let app;
            // نستورد المكتبات أولاً
            Promise.all([
                import("https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"),
                import("https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js")
            ]).then(([{ initializeApp }, { getFirestore, collection, query, orderBy, limit, onSnapshot, getDocs }]) => {
                
                try {
                    app = initializeApp(WIDGET_CONFIG.firebaseConfig);
                } catch (e) {
                    console.warn("Firebase App is likely already initialized.");
                    // لا نوقف التنفيذ، قد يكون التهيئة تمت في مكان آخر
                }
                const db = getFirestore(app);
                const q = query(collection(db, WIDGET_CONFIG.collectionName), orderBy("createdAt", "desc"), limit(WIDGET_CONFIG.maxNotificationsToShow));

                onSnapshot(q, (snapshot) => {
                    const notifications = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderNotifications(notifications);
                    updateUnreadCount(notifications);
                }, (error) => {
                    console.error("Error fetching notifications: ", error);
                    renderError();
                });

                function renderNotifications(notifications) {
                    if (notifMenu) notifMenu.innerHTML = '';
                    if (updatesListContainer) updatesListContainer.innerHTML = '';

                    if (notifications.length === 0) {
                        if (notifMenu) notifMenu.innerHTML = '<div class="Tawasle-Notif-Item"><a><p>لا توجد إشعارات جديدة</p></a></div>';
                        if (updatesListContainer) updatesListContainer.innerHTML = '<li><a><p>لا توجد تحديثات لعرضها حاليًا.</p></a></li>';
                        return;
                    }

                    notifications.forEach(notif => {
                        const itemHTML = createNotificationItemHTML(notif);
                        if (notifMenu) {
                            const dropdownItem = document.createElement('div');
                            dropdownItem.className = 'Tawasle-Notif-Item';
                            dropdownItem.innerHTML = itemHTML;
                            notifMenu.appendChild(dropdownItem);
                        }
                        if (updatesListContainer) {
                            const listItem = document.createElement('li');
                            listItem.innerHTML = itemHTML;
                            updatesListContainer.appendChild(listItem);
                        }
                    });
                }

                function createNotificationItemHTML(notif) {
                    const iconClass = notif.icon || 'fas fa-bell';
                    const text = notif.text || 'لا يوجد نص.';
                    const content = `<i class="${iconClass}"></i><p>${text}</p>`;
                    const link = notif.link || '#';
                    const target = notif.link ? 'target="_blank" rel="noopener noreferrer"' : '';
                    return `<a href="${link}" ${target}>${content}</a>`;
                }
                
                function renderError() {
                    if (notifMenu) notifMenu.innerHTML = '<div class="Tawasle-Notif-Item"><a><p>خطأ في تحميل الإشعارات</p></a></div>';
                    if (updatesListContainer) updatesListContainer.innerHTML = '<li><a><p>خطأ في تحميل التحديثات.</p></a></li>';
                }

                function updateUnreadCount(notifications) {
                    if (notifications.length === 0) return;
                    const lastSeenTimestamp = parseInt(localStorage.getItem(WIDGET_CONFIG.localStorageKey) || '0');
                    const unreadCount = notifications.filter(n => n.createdAt && n.createdAt.toMillis() > lastSeenTimestamp).length;

                    if (unreadCount > 0) {
                        notifCountSpan.textContent = unreadCount > 9 ? '9+' : unreadCount;
                        notifCountSpan.style.display = 'flex';
                    } else {
                        notifCountSpan.style.display = 'none';
                    }
                }

                notifBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    notifMenu.classList.toggle('Tawasle-Notif-Dropdown-Show');
                    if (notifMenu.classList.contains('Tawasle-Notif-Dropdown-Show')) {
                        const qLatest = query(collection(db, WIDGET_CONFIG.collectionName), orderBy("createdAt", "desc"), limit(1));
                        getDocs(qLatest).then(snapshot => {
                            if (!snapshot.empty) {
                                const latestNotif = snapshot.docs[0].data();
                                if(latestNotif.createdAt) {
                                    localStorage.setItem(WIDGET_CONFIG.localStorageKey, latestNotif.createdAt.toMillis().toString());
                                }
                            }
                            notifCountSpan.style.display = 'none';
                        });
                    }
                });

            }).catch(error => console.error("Error loading Firebase modules:", error));

            document.addEventListener('click', (event) => {
                if (notifMenu && !notifMenu.contains(event.target) && !notifBtn.contains(event.target)) {
                    notifMenu.classList.remove('Tawasle-Notif-Dropdown-Show');
                }
            });
        });
    })();
</script>

<script>
// --- باقي الأكواد الخاصة بالقوائم والوضع الليلي تبقى كما هي ---
document.addEventListener('DOMContentLoaded', () => {
    const body = document.body;
    const overlay = document.querySelector('.overlay');
    const sideBar = document.querySelector('.side-bar');
    const menuBtn = document.querySelector('#menu-btn');
    const closeBtn = document.querySelector('#close-btn');
    const profileBtn = document.querySelector('#user-btn');
    const profileDropdown = document.querySelector('.profile-dropdown');
    const toggleBtn = document.querySelector('#toggle-btn');
    const dangerBtn = document.getElementById('danger-btn'); // افترض أن لديك modal لهذا الزر

    const closeAllPopups = () => {
        sideBar.classList.remove('active');
        profileDropdown.classList.remove('active');
        overlay.classList.remove('active');
        body.style.overflow = 'auto';
    };

    menuBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        closeAllPopups();
        sideBar.classList.add('active');
        overlay.classList.add('active');
        body.style.overflow = 'hidden';
    });

    profileBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const isAlreadyActive = profileDropdown.classList.contains('active');
        closeAllPopups();
        if (!isAlreadyActive) {
            profileDropdown.classList.add('active');
        }
    });

    closeBtn.addEventListener('click', closeAllPopups);
    overlay.addEventListener('click', closeAllPopups);
    document.addEventListener('keydown', (e) => e.key === 'Escape' && closeAllPopups());
    
    // --- الوضع الليلي ---
    const applyTheme = (theme) => {
        if (theme === 'dark') {
            body.classList.add('dark-mode');
            toggleBtn.classList.replace('fa-sun', 'fa-moon');
        } else {
            body.classList.remove('dark-mode');
            toggleBtn.classList.replace('fa-moon', 'fa-sun');
        }
    };
    applyTheme(localStorage.getItem('theme'));
    toggleBtn.addEventListener('click', () => {
        let newTheme = body.classList.contains('dark-mode') ? 'light' : 'dark';
        applyTheme(newTheme);
        localStorage.setItem('theme', newTheme);
    });
});
</script>

</body>
</html>

































<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تنبيه طبي - TAWASLE_ADAT</title>
    <style>
        /* CSS Variables for easier theme management */
        :root {
            --medical-primary-color: #3498db;
            --medical-primary-dark-color: #2980b9;
            --medical-secondary-color: #ffffff;
            --medical-text-color: #333;
            --medical-light-bg-color: #f5f5f5;
            --medical-overlay-bg-color: rgba(0, 0, 0, 0.8);
            --medical-font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

   

        /* Overlay */
        .medical-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--medical-overlay-bg-color);
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .medical-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Popup Container - Fullscreen */
        .medical-popup-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            z-index: 8002;
            background: var(--medical-secondary-color);
            transform: scale(0.95);
            opacity: 0;
            visibility: hidden;
            transition: transform 0.3s ease, opacity 0.3s ease, visibility 0.3s ease;
            overscroll-behavior: contain;
        }

        .medical-popup-container.active {
            transform: scale(1);
            opacity: 1;
            visibility: visible;
        }

        .medical-popup-header {
            background: linear-gradient(to left, var(--medical-primary-color), var(--medical-primary-dark-color));
            color: var(--medical-secondary-color);
            padding: 1rem 1.25rem;
            text-align: center;
            position: relative;
            flex-shrink: 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .medical-popup-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .medical-popup-content {
            flex-grow: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            background-color: var(--medical-light-bg-color);
        }

        /* Close Button */
        .medical-close-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            left: 1rem;
            background: rgba(255, 255, 255, 0.2);
            color: var(--medical-secondary-color);
            border: none;
            width: 2.25rem;
            height: 2.25rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.2s;
        }

        .medical-close-btn:active {
            transform: translateY(-50%) scale(0.9);
            background: rgba(255, 255, 255, 0.3);
        }

        /* Loader */
        .medical-loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 1.25rem;
        }

        .medical-spinner {
            width: 3.125rem;
            height: 3.125rem;
            border: 5px solid rgba(52, 152, 219, 0.2);
            border-top: 5px solid var(--medical-primary-color);
            border-radius: 50%;
            animation: medicalSpin 1s linear infinite;
        }

        @keyframes medicalSpin {
            to { transform: rotate(360deg); }
        }

        .medical-loader p {
            color: #7f8c8d;
            font-size: 1.1rem;
            margin-top: 1rem;
        }
        
        /* Disable hover effects on touch devices for a better UX */
        @media (hover: hover) {
            .medical-alert-btn:hover {
                transform: scale(1.1);

               }
            .medical-close-btn:hover {
                transform: translateY(-50%) rotate(90deg);
                background: rgba(0, 0, 0, 0.2);
            }
        }
    </style>
</head>
<body>


<div class="medical-overlay" id="medicalOverlay"></div>

<div class="medical-popup-container" id="medicalPopupContainer" role="dialog" aria-modal="true" aria-labelledby="medicalPopupTitle">
    <div class="medical-popup-header">
        <button class="medical-close-btn" onclick="medicalTogglePopup()" aria-label="إغلاق النافذة">×</button>
        <h2 id="medicalPopupTitle">تنبيه - محتوى TAWASLE_ADAT</h2>
    </div>
    <div class="medical-popup-content" id="medicalContentContainer">
        <!-- Content will be loaded here -->
        <div class="medical-loader">
            <div class="medical-spinner"></div>
            <p>جاري تحميل المحتوى...</p>
        </div>
    </div>
</div>

<script>
    // Medical Alert variables
    let isMedicalContentLoaded = false;
    const MEDICAL_TARGET_URL = "https://s22mcs.github.io/S22MCS02-/TAWASLE_ADAT_EALM_KISM_EL_TIB.html";
    
    // DOM Elements
    const medicalPopupContainer = document.getElementById('medicalPopupContainer');
    const medicalOverlay = document.getElementById('medicalOverlay');
    const medicalContentContainer = document.getElementById('medicalContentContainer');
    const medicalAlertBtn = document.querySelector('.medical-alert-btn');
    
    // Toggle popup visibility
    function medicalTogglePopup() {
        const isActive = medicalPopupContainer.classList.contains('active');
        isActive ? medicalClosePopup() : medicalOpenPopup();
    }
    
    function medicalOpenPopup() {
        medicalAlertBtn.style.animation = 'none';
        medicalOverlay.classList.add('active');
        medicalPopupContainer.classList.add('active');
        document.body.classList.add('medical-popup-open');
        medicalVibrate(10);

        if (!isMedicalContentLoaded) {
            medicalLoadContent();
        }
    }
    
    function medicalClosePopup() {
        medicalAlertBtn.style.animation = 'medicalPulse 2s infinite';
        medicalOverlay.classList.remove('active');
        medicalPopupContainer.classList.remove('active');
        document.body.classList.remove('medical-popup-open');
        medicalVibrate(10);
    }
    
    // Load content via iframe
    function medicalLoadContent() {
        medicalShowIframeContent();
        isMedicalContentLoaded = true;
    }
    
    // Display content using an iframe
    function medicalShowIframeContent() {
        // Clear loader before inserting iframe
        medicalContentContainer.innerHTML = ''; 
        
        const iframe = document.createElement('iframe');
        iframe.src = MEDICAL_TARGET_URL;
        iframe.style.width = "100%";
        iframe.style.height = "100%";
        iframe.style.border = "none";
        iframe.sandbox = "allow-same-origin allow-scripts allow-popups allow-forms";
        iframe.loading = "lazy";
        iframe.title = "محتوى طبي خارجي";
        
        // Handle loading errors
        iframe.onerror = () => {
             medicalShowError({ message: 'فشل تحميل المحتوى. يرجى التحقق من اتصالك بالإنترنت.' });
        };

        medicalContentContainer.appendChild(iframe);
    }
    
    // Display an error message
    function medicalShowError(error) {
        medicalContentContainer.innerHTML = `
            <div class="medical-loader">
                <div style="color: var(--medical-primary-color); margin-bottom: 1rem; font-size: 1.2rem;">⚠️ خطأ في تحميل المحتوى</div>
                <p style="margin-bottom: 1.25rem; color: #555;">${error.message}</p>
                <button onclick="medicalRetryLoading()" 
                        style="padding: 10px 25px; background: var(--medical-primary-color); color: white; border: none; border-radius: 30px; font-size: 1rem; box-shadow: 0 3px 10px rgba(0,0,0,0.2); cursor: pointer; transition: all 0.2s;">
                    إعادة المحاولة
                </button>
            </div>
        `;
    }
    
    // Retry loading content
    function medicalRetryLoading() {
        medicalVibrate(20);
        medicalContentContainer.innerHTML = `
            <div class="medical-loader">
                <div class="medical-spinner"></div>
                <p>جاري إعادة تحميل المحتوى...</p>
            </div>
        `;
        // Reset state and try again
        isMedicalContentLoaded = false;
        setTimeout(medicalLoadContent, 500);
    }
    
    // Event listeners
    medicalOverlay.addEventListener('click', medicalClosePopup);
    
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && medicalPopupContainer.classList.contains('active')) {
            medicalClosePopup();
        }
    });
    
    // Haptic feedback function
    function medicalVibrate(duration_ms) {
        if ('vibrate' in navigator && !('connection' in navigator && navigator.connection.saveData)) {
            navigator.vibrate(duration_ms);
        }
    }
    
    medicalAlertBtn.addEventListener('click', () => medicalVibrate(10));

</script>

</body>
</html>






















































