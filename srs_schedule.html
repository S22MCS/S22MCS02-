<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ - Ø§Ù„Ø°Ø§ÙƒØ±Ø© PRO</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        tailwind.config = { 
            darkMode: 'class', 
            theme: { 
                extend: { 
                    fontFamily: { sans: ['Tajawal', 'sans-serif'] }, 
                    colors: { 
                        brand: { DEFAULT: '#2563eb', dark: '#1d4ed8' }, 
                        dark: { bg: '#0f172a', card: '#1e293b', sidebar: '#111827' } 
                    },
                    padding: { 'safe': 'env(safe-area-inset-bottom)' } // Ù„Ø¯Ø¹Ù… Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ
                } 
            } 
        }
    </script>
    <style>
        body { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-dark-bg text-slate-800 font-sans transition-colors duration-300 pb-24 md:pb-0">

    <aside class="hidden md:flex fixed top-0 right-0 h-full w-64 bg-white dark:bg-dark-sidebar border-l border-gray-200 dark:border-gray-700 z-50 flex-col p-6 shadow-xl">
        <div class="flex items-center gap-3 mb-10">
            <div class="w-10 h-10 bg-brand rounded-xl flex items-center justify-center text-white shadow-lg shadow-brand/40"><i class="fas fa-brain text-xl"></i></div>
            <h1 class="font-black text-xl dark:text-white">Ø§Ù„Ø°Ø§ÙƒØ±Ø© <span class="text-brand">PRO</span></h1>
        </div>
        <nav class="space-y-2 flex-1">
            <a href="srs_index.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-500 hover:bg-gray-50 dark:hover:bg-slate-800 transition"><i class="fas fa-home w-6"></i> Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</a>
            <a href="srs_schedule.html" class="flex items-center gap-3 px-4 py-3 rounded-xl bg-brand/10 text-brand font-bold transition"><i class="far fa-calendar-alt w-6"></i> Ø§Ù„Ø¬Ø¯ÙˆÙ„</a>
            <a href="srs_manage.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-500 hover:bg-gray-50 dark:hover:bg-slate-800 transition"><i class="fas fa-edit w-6"></i> Ø§Ù„Ù…Ø­ØªÙˆÙ‰</a>
            <a href="srs_library.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-500 hover:bg-gray-50 dark:hover:bg-slate-800 transition"><i class="fas fa-layer-group w-6"></i> Ø§Ù„Ù…ÙƒØªØ¨Ø©</a>
            <a href="srs_stats.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-500 hover:bg-gray-50 dark:hover:bg-slate-800 transition"><i class="fas fa-chart-pie w-6"></i> Ø§Ù„ØªØ­Ù„ÙŠÙ„</a>
            <div class="my-4 border-t border-gray-100 dark:border-gray-700"></div>
            <a href="srs_settings.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-500 hover:bg-gray-50 dark:hover:bg-slate-800 transition"><i class="fas fa-cog w-6"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
        </nav>
    </aside>

    <main class="md:mr-64 min-h-screen p-4 md:p-8">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-black text-slate-800 dark:text-white">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ğŸ—“ï¸</h1>
            <a href="srs_study.html" class="bg-brand hover:bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-brand/30 transition flex items-center gap-2 active:scale-95">
                <i class="fas fa-play"></i> Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¢Ù†
            </a>
        </header>

        <div class="space-y-8" id="scheduleContainer">
            </div>
    </main>

    <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-dark-card border-t border-gray-200 dark:border-gray-700 pb-safe z-50 flex justify-around items-center h-16 shadow-[0_-5px_15px_rgba(0,0,0,0.05)]">
        <a href="srs_index.html" class="flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-brand dark:hover:text-blue-400 transition"><i class="fas fa-home text-xl mb-1"></i><span class="text-[10px] font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></a>
        
        <a href="srs_schedule.html" class="flex flex-col items-center justify-center w-full h-full text-brand dark:text-blue-400 transition"><i class="far fa-calendar-alt text-xl mb-1"></i><span class="text-[10px] font-bold">Ø§Ù„Ø¬Ø¯ÙˆÙ„</span></a>
        
        <div class="relative -top-5">
            <button onclick="openModal()" class="w-14 h-14 bg-brand text-white rounded-full shadow-xl shadow-brand/40 flex items-center justify-center text-2xl transform transition active:scale-90 hover:scale-105 border-4 border-slate-50 dark:border-dark-bg">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <a href="srs_stats.html" class="flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-brand dark:hover:text-blue-400 transition"><i class="fas fa-chart-pie text-xl mb-1"></i><span class="text-[10px] font-bold">ØªØ­Ù„ÙŠÙ„</span></a>
        
        <a href="srs_settings.html" class="flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-brand dark:hover:text-blue-400 transition"><i class="fas fa-cog text-xl mb-1"></i><span class="text-[10px] font-bold">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></a>
    </nav>
    
    <div id="addModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="relative bg-white dark:bg-dark-card w-full max-w-lg rounded-3xl shadow-2xl p-6 md:p-8 transform scale-90 opacity-0 transition-all duration-300" id="modalCard">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-black text-slate-800 dark:text-white">Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯</h3>
                <button onclick="closeModal()" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-slate-700 flex items-center justify-center text-gray-500 dark:text-gray-300 transition hover:bg-red-500/10 hover:text-red-500"><i class="fas fa-times"></i></button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="text-xs font-bold text-gray-500 mb-1 block">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <input type="text" id="inpSubject" list="subjectsList" class="w-full bg-gray-50 dark:bg-slate-800 border-transparent focus:border-brand rounded-xl p-4 font-bold dark:text-white outline-none border-2 transition" placeholder="Ù…Ø«Ø§Ù„: ØªØ´Ø±ÙŠØ­...">
                    <datalist id="subjectsList"></datalist>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500 mb-1 block">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³ / Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</label>
                    <input type="text" id="inpTitle" class="w-full bg-gray-50 dark:bg-slate-800 border-transparent focus:border-brand rounded-xl p-4 font-bold dark:text-white outline-none border-2 transition" placeholder="Ù…Ø§ Ù‡ÙŠ Ø¯ÙˆØ±Ø© ÙƒØ±ÙŠØ¨Ø³ØŸ">
                </div>
                <button onclick="saveLesson()" class="w-full bg-brand text-white font-black py-4 rounded-xl shadow-lg shadow-brand/30 mt-4 active:scale-95 transition hover:bg-brand-dark">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
            </div>
        </div>
    </div>

    <script>
        const DB_KEY = 'srs_pro_db_v1';
        const SETTINGS_KEY = 'srs_pro_settings_v1';
        let appData = { lessons: [], user: { streak: 0, lastLogin: null, totalReviews: 0 } };

        function init() {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const d = localStorage.getItem(DB_KEY);
            if(d) appData = JSON.parse(d);

            // ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
            const s = localStorage.getItem(SETTINGS_KEY);
            if(s && JSON.parse(s).darkMode) document.documentElement.classList.add('dark');
            
            renderSchedule();

            // ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© (Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ©)
            const subs = [...new Set(appData.lessons.map(l => l.subject).filter(s => s))];
            document.getElementById('subjectsList').innerHTML = subs.map(s => `<option value="${s}">`).join('');
        }
        
        // ===================================
        //           Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ
        // ===================================

        function renderSchedule() {
            const data = JSON.parse(localStorage.getItem(DB_KEY)) || { lessons: [] };
            const lessons = data.lessons;
            const container = document.getElementById('scheduleContainer');
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
            const today = new Date(); today.setHours(0,0,0,0);
            const tomorrow = new Date(today); tomorrow.setDate(tomorrow.getDate() + 1);
            
            const groups = { overdue: [], today: [], tomorrow: [], later: [] };

            lessons.sort((a, b) => new Date(a.nextReview) - new Date(b.nextReview));

            lessons.forEach(l => {
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø®ØµØ§Ø¦Øµ Ø£Ø³Ø§Ø³ÙŠØ©
                if (l.layer === undefined) l.layer = 0;

                const due = new Date(l.nextReview); due.setHours(0,0,0,0);
                
                if (due < today) groups.overdue.push(l);
                else if (due.getTime() === today.getTime()) groups.today.push(l);
                else if (due.getTime() === tomorrow.getTime()) groups.tomorrow.push(l);
                else groups.later.push(l);
            });

            let html = '';

            // 1. Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©
            if (groups.overdue.length > 0) {
                html += createSection('Ù…ØªØ£Ø®Ø±Ø©', groups.overdue, 'text-red-500', 'border-red-500', 'ÙŠØ¬Ø¨ Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§ ÙÙˆØ±Ø§Ù‹');
            }

            // 2. Ø§Ù„ÙŠÙˆÙ…
            html += createSection('Ø§Ù„ÙŠÙˆÙ…', groups.today, 'text-green-600', 'border-green-500', 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù„Ù„ÙŠÙˆÙ…ØŒ Ø®Ø° Ø±Ø§Ø­Ø©!');

            // 3. ØºØ¯Ø§Ù‹
            if (groups.tomorrow.length > 0) {
                html += createSection('ØºØ¯Ø§Ù‹', groups.tomorrow, 'text-blue-500', 'border-blue-500', 'ÙƒÙ„ Ø´ÙŠØ¡ Ù…Ø¹Ø¯ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ØºØ¯Ø§Ù‹');
            }

            // 4. Ù‚Ø§Ø¯Ù…Ø©
            if (groups.later.length > 0) {
                html += createSection('Ù‚Ø§Ø¯Ù…Ø©', groups.later, 'text-gray-500', 'border-gray-300', 'Ø®Ø·ØªÙƒ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©');
            }
            
            if (lessons.length === 0) {
                container.innerHTML = `<div class="text-center py-16 bg-white dark:bg-dark-card rounded-3xl border border-dashed border-gray-200 dark:border-gray-700 shadow-inner">
                    <div class="w-16 h-16 bg-brand/10 rounded-full flex items-center justify-center mx-auto mb-4 text-brand text-2xl"><i class="fas fa-clipboard-list"></i></div>
                    <h3 class="font-black text-xl dark:text-white mb-2">Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙØ§Ø±Øº!</h3>
                    <p class="text-gray-500 mb-4">Ø£Ø¶Ù Ø£ÙˆÙ„ Ø¯Ø±Ø³ Ù„Ùƒ Ù„Ø¨Ø¯Ø¡ Ø±Ø­Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…ØªØ¨Ø§Ø¹Ø¯.</p>
                    <button onclick="openModal()" class="bg-brand text-white text-sm font-bold px-5 py-2.5 rounded-full shadow-lg shadow-brand/30 active:scale-95 transition">
                        <i class="fas fa-plus ml-1"></i> Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>`;
                return;
            }

            container.innerHTML = html;
        }

        function createSection(title, items, colorClass, borderClass, emptyMsg) {
            if (items.length === 0 && !emptyMsg) return '';
            
            let sectionHtml = `
                <div class="py-4 border-b border-gray-100 dark:border-gray-800 last:border-b-0">
                    <h2 class="text-xl font-bold mb-4 ${colorClass} flex items-center gap-2">
                        <i class="fas fa-calendar-day"></i> ${title} 
                        <span class="text-sm font-medium bg-gray-100 dark:bg-slate-700 px-3 py-0.5 rounded-full text-gray-500">${items.length}</span>
                    </h2>
            `;

            if (items.length === 0) {
                sectionHtml += `<div class="p-4 rounded-2xl bg-gray-50 dark:bg-slate-800 text-gray-400 text-sm font-bold text-center border-2 border-dashed border-gray-200 dark:border-gray-700">${emptyMsg}</div>`;
            } else {
                sectionHtml += `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">`;
                items.forEach(l => {
                    const date = new Date(l.nextReview).toLocaleDateString('ar-EG', { weekday: 'long', month: 'long', day: 'numeric' });
                    sectionHtml += `
                        <div class="bg-white dark:bg-dark-card p-4 rounded-2xl shadow-sm border-r-4 ${borderClass} dark:border-opacity-50 hover:shadow-lg transition">
                            <div class="text-[10px] text-gray-400 font-bold mb-1">${l.subject}</div>
                            <h3 class="font-bold text-slate-800 dark:text-white truncate">${l.title}</h3>
                            <div class="mt-3 flex justify-between items-center text-xs text-gray-400">
                                <span class="text-blue-500"><i class="fas fa-layer-group"></i> Ù…Ø³ØªÙˆÙ‰ ${l.layer}</span>
                                <span>${date}</span>
                            </div>
                        </div>
                    `;
                });
                sectionHtml += `</div>`;
            }
            sectionHtml += `</div>`;
            return sectionHtml;
        }

        // ===================================
        //           Ù…Ù†Ø·Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ©
        // ===================================

        function openModal() {
            document.getElementById('addModal').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('modalCard').classList.remove('scale-90', 'opacity-0');
                document.getElementById('modalCard').classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeModal() {
            document.getElementById('modalCard').classList.remove('scale-100', 'opacity-100');
            document.getElementById('modalCard').classList.add('scale-90', 'opacity-0');
            setTimeout(() => document.getElementById('addModal').classList.add('hidden'), 300);
        }

        function saveLesson() {
            const subject = document.getElementById('inpSubject').value.trim();
            const title = document.getElementById('inpTitle').value.trim();
            
            if(!subject || !title) {
                Swal.fire({ icon: 'error', title: 'Ø®Ø·Ø£', text: 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø­Ù‚Ù„ Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù†.', toast: true, position: 'top-end', showConfirmButton: false, timer: 2000 });
                return;
            }
            
            const now = new Date();
            const next = new Date(); 
            next.setDate(now.getDate() + 1); // Ø£ÙˆÙ„ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨Ø¹Ø¯ ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯

            appData.lessons.push({ 
                id: Date.now() + Math.random(), 
                subject, 
                title, 
                layer: 0, 
                nextReview: next.toISOString(), 
                lastReview: now.toISOString(), 
                easeFactor: 2.5 
            });
            
            localStorage.setItem(DB_KEY, JSON.stringify(appData));
            
            closeModal();
            renderSchedule(); // Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙˆØ±Ø§Ù‹
            document.getElementById('inpTitle').value = '';
            
            Swal.fire({ 
                icon: 'success', 
                title: 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø³!', 
                toast: true, 
                position: 'top-end', 
                showConfirmButton: false, 
                timer: 1500 
            });
        }

        
        init();
    </script>
</body>
</html>