<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #1e272e; color: #ecf0f1; font-family: 'Cairo', sans-serif; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { width: 100%; max-width: 700px; flex: 1; }
        
        h2 { color: #0fb9b1; text-align: center; margin-bottom: 30px; border-bottom: 2px solid #34495e; padding-bottom: 20px; }
        
        .form-card { background: #2f3640; padding: 25px; border-radius: 15px; margin-bottom: 30px; border: 1px solid #4b6584; }
        
        input, button { width: 100%; padding: 12px; margin-bottom: 12px; border-radius: 8px; font-family: inherit; font-size: 1rem; border: none; }
        input { background: #dcdde1; color: #2d3436; }
        input:focus { outline: 2px solid #0fb9b1; }
        
        .btn-add { background: #20bf6b; color: white; cursor: pointer; font-weight: bold; }
        .btn-add:hover { background: #26de81; }
        .btn-add.editing { background: #f7b731; color: #2d3436; } /* Ù„ÙˆÙ† Ù…Ø®ØªÙ„Ù Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */
        
        .level-item { background: #353b48; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-right: 4px solid #0fb9b1; }
        .actions { display: flex; gap: 5px; }
        .btn-action { width: auto; padding: 5px 15px; cursor: pointer; color: white; border-radius: 5px; font-size: 0.9rem; }
        .btn-del { background: #eb3b5a; }
        .btn-edit { background: #3867d6; }
        
        .footer { margin-top: 30px; color: #7f8fa6; font-size: 0.9rem; text-align: center; width: 100%; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø£Ø¯Ø§Ø© Ø¹Ù„Ù…</h2>

    <div class="form-card" id="form-area">
        <h3 style="margin-top:0; color:#4bcffa;" id="form-title">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø­Ù„Ø©</h3>
        
        <input type="text" id="inp-q" placeholder="Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø¹Ø±Ø¨ÙŠ)">
        <input type="text" id="inp-q-en" placeholder="Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ - Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" dir="ltr">
        <input type="text" id="inp-q-fr" placeholder="Ø§Ù„Ø³Ø¤Ø§Ù„ (ÙØ±Ù†Ø³ÙŠ - Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" dir="ltr">
        <input type="text" id="inp-a" placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© (Ø¹Ø±Ø¨ÙŠ)">
        
        <div style="background:#dcdde1; border-radius:8px; padding:5px; display:flex; align-items:center;">
            <input type="file" id="inp-file" accept="image/*" style="margin:0; background:transparent;">
            <span id="upload-msg" style="margin-right:10px; color:#2d3436; font-weight:bold;"></span>
        </div>
        <input type="hidden" id="inp-img-url">

        <button id="btn-submit" class="btn-add" onclick="handleAddLevel()" style="margin-top:15px;">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±Ø­Ù„Ø©</button>
        <button id="btn-cancel" onclick="cancelEdit()" style="background:#636e72; color:white; display:none;">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
    </div>

    <h3 style="color:#d1d8e0">ğŸ“‹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</h3>
    <div id="list-levels"></div>
    
    <div style="text-align:center; margin-top:20px">
        <button onclick="resetGame()" style="background:#eb3b5a; width:auto; color:white">âš ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>
</div>

<div class="footer">ØµÙ†Ø¹Øª Ù…Ù† Ø·Ø±Ù <b>Ø£Ø¯Ø§Ø© Ø¹Ù„Ù…</b> Ù‚Ø³Ù… Ø§Ù„Ø·Ø¨ ğŸ§ª</div>

<script>
    const STORAGE_KEY = 'shared_game_v5'; 
    const IMGBB_KEY = "ac296feb5a275923598bdbfd4f9aed8c"; 

    const DEFAULT_DATA = { levels: [], progress: 0, coins: 100 };
    let data = {};
    let editingIndex = -1; // Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªÙŠ ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§

    async function uploadImageToImgBB(file) {
        const formData = new FormData();
        formData.append('image', file);
        formData.append('key', IMGBB_KEY);
        try {
            const response = await fetch('https://api.imgbb.com/1/upload', { method: 'POST', body: formData });
            const result = await response.json();
            if (result.success) return result.data.url;
            else throw new Error(result.error.message);
        } catch (error) {
            alert("ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹: " + error.message);
            return null;
        }
    }

    function load() {
        const saved = localStorage.getItem(STORAGE_KEY);
        data = saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(DEFAULT_DATA));
        render();
    }

    function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); render(); }

    function render() {
        const list = document.getElementById('list-levels');
        list.innerHTML = '';
        data.levels.forEach((lvl, i) => {
            const div = document.createElement('div');
            div.className = 'level-item';
            div.innerHTML = `
                <div>
                    <strong>#${i+1}: ${lvl.a}</strong><br>
                    <small>${lvl.q}</small>
                </div>
                <div class="actions">
                    <button class="btn-action btn-edit" onclick="editLevel(${i})">âœï¸</button>
                    <button class="btn-action btn-del" onclick="delLevel(${i})">ğŸ—‘ï¸</button>
                </div>
            `;
            list.appendChild(div);
        });
    }

    // ØªØ¬Ù‡ÙŠØ² Ø§Ù„ÙÙˆØ±Ù… Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
    function editLevel(index) {
        editingIndex = index;
        const lvl = data.levels[index];
        
        document.getElementById('inp-q').value = lvl.q || '';
        document.getElementById('inp-q-en').value = lvl.q_en || '';
        document.getElementById('inp-q-fr').value = lvl.q_fr || '';
        document.getElementById('inp-a').value = lvl.a || '';
        document.getElementById('inp-img-url').value = lvl.img || '';
        
        // ØªØºÙŠÙŠØ± Ø´ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        document.getElementById('form-title').innerText = "âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø±Ø­Ù„Ø© #" + (index+1);
        const btn = document.getElementById('btn-submit');
        btn.innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
        btn.classList.add('editing');
        document.getElementById('btn-cancel').style.display = 'block';
        
        // Ø§Ù„ØµØ¹ÙˆØ¯ Ù„Ù„Ø£Ø¹Ù„Ù‰
        document.getElementById('form-area').scrollIntoView({ behavior: 'smooth' });
    }

    function cancelEdit() {
        editingIndex = -1;
        document.getElementById('inp-q').value = '';
        document.getElementById('inp-q-en').value = '';
        document.getElementById('inp-q-fr').value = '';
        document.getElementById('inp-a').value = '';
        document.getElementById('inp-file').value = '';
        document.getElementById('inp-img-url').value = '';
        
        document.getElementById('form-title').innerText = "â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±Ø­Ù„Ø©";
        const btn = document.getElementById('btn-submit');
        btn.innerText = "Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±Ø­Ù„Ø©";
        btn.classList.remove('editing');
        document.getElementById('btn-cancel').style.display = 'none';
    }

    async function handleAddLevel() {
        const q = document.getElementById('inp-q').value;
        const q_en = document.getElementById('inp-q-en').value;
        const q_fr = document.getElementById('inp-q-fr').value;
        const a = document.getElementById('inp-a').value;
        const fileInput = document.getElementById('inp-file');
        const hiddenImgUrl = document.getElementById('inp-img-url').value; // Ù„Ù„ØµÙˆØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        
        const btn = document.getElementById('btn-submit');
        const msg = document.getElementById('upload-msg');

        if(!q || !a) { alert('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù†Ø§Ù‚ØµØ©'); return; }

        let finalImgUrl = hiddenImgUrl;

        // Ø¥Ø°Ø§ Ù‚Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
        if (fileInput.files.length > 0) {
            msg.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹... â³";
            btn.disabled = true;
            finalImgUrl = await uploadImageToImgBB(fileInput.files[0]);
            btn.disabled = false;
            if(!finalImgUrl) { msg.innerText = "âŒ Ø®Ø·Ø£"; return; }
        }

        const newLevelObj = { q, q_en, q_fr, a, img: finalImgUrl };

        if (editingIndex > -1) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
            data.levels[editingIndex] = newLevelObj;
            alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­");
        } else {
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
            data.levels.push(newLevelObj);
        }

        save();
        cancelEdit(); // Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
        msg.innerText = "";
    }

    function delLevel(i) {
        if(confirm('Ø­Ø°ÙØŸ')) {
            data.levels.splice(i, 1);
            save();
            // Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ù†Ø¹Ø¯Ù„ Ù†ÙØ³ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø°ÙŠ Ø­Ø°ÙÙ†Ø§Ù‡ØŒ Ù†Ù„ØºÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            if(editingIndex === i) cancelEdit();
        }
    }

    function resetGame() {
        if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡ØŸ')) {
            localStorage.removeItem(STORAGE_KEY);
            location.reload();
        }
    }

    load();
</script>
</body>
</html>