<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ - Ø§Ù„Ø°Ø§ÙƒØ±Ø© PRO</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        tailwind.config = { 
            darkMode: 'class', 
            theme: { 
                extend: { 
                    fontFamily: { sans: ['Tajawal', 'sans-serif'] }, 
                    colors: { brand: { DEFAULT: '#2563eb' }, dark: { bg: '#0f172a', card: '#1e293b', sidebar: '#111827' } } 
                } 
            } 
        }
    </script>
</head>
<body class="bg-slate-50 dark:bg-dark-bg text-slate-800 font-sans transition-colors duration-300">

    <div class="md:hidden fixed top-4 left-4 z-40">
        <button onclick="toggleSidebar()" class="bg-white dark:bg-dark-card text-brand p-3 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 hover:bg-gray-50 transition">
            <i class="fas fa-bars text-xl"></i>
        </button>
    </div>

    <div id="sidebarOverlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-40 hidden transition-opacity duration-300 opacity-0 backdrop-blur-sm"></div>

    <aside id="sidebar" class="fixed top-0 right-0 h-full w-64 bg-white dark:bg-dark-sidebar border-l border-gray-200 dark:border-gray-700 z-50 transform translate-x-full md:translate-x-0 transition-transform duration-300 shadow-2xl md:shadow-none">
        <div class="p-6 h-full flex flex-col">
            <div class="flex items-center justify-between mb-10">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-brand rounded-xl flex items-center justify-center text-white shadow-lg"><i class="fas fa-brain text-xl"></i></div>
                    <h1 class="font-black text-xl dark:text-white">Ø§Ù„Ø°Ø§ÙƒØ±Ø© <span class="text-brand">PRO</span></h1>
                </div>
                <button onclick="toggleSidebar()" class="md:hidden text-gray-400 hover:text-red-500 transition p-2">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <nav class="space-y-2 flex-1 overflow-y-auto">
                <a href="srs_index.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-500 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-slate-800 font-medium transition"><i class="fas fa-home w-6"></i> Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</a>
                <a href="srs_schedule.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-500 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-slate-800 font-medium transition"><i class="far fa-calendar-alt w-6"></i> Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¯Ù…</a>
                
                <a href="srs_manage.html" class="flex items-center gap-3 px-4 py-3 rounded-xl bg-brand/10 text-brand font-bold transition"><i class="fas fa-edit w-6"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</a>
                
                <a href="srs_library.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-500 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-slate-800 font-medium transition"><i class="fas fa-layer-group w-6"></i> Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„Ù…Ù†Ø§Ù‡Ø¬</a>
                <a href="srs_stats.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-500 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-slate-800 font-medium transition"><i class="fas fa-chart-pie w-6"></i> Ø§Ù„ØªØ­Ù„ÙŠÙ„</a>
                
                <div class="my-4 border-t border-gray-100 dark:border-gray-700"></div>
                <a href="srs_guide.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-500 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-slate-800 font-medium transition"><i class="fas fa-book-open w-6"></i> Ø§Ù„Ø¯Ù„ÙŠÙ„ ÙˆØ§Ù„Ø¥Ø±Ø´Ø§Ø¯</a>
                <a href="srs_settings.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-500 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-slate-800 font-medium transition"><i class="fas fa-cog w-6"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
            </nav>
        </div>
    </aside>

    <main class="md:mr-64 min-h-screen p-6 transition-all duration-300">
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4 mt-12 md:mt-0">
            <div class="text-center md:text-right w-full md:w-auto">
                <h1 class="text-3xl font-black text-slate-800 dark:text-white">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯Ø±ÙˆØ³ ğŸ“</h1>
                <p class="text-gray-500 text-sm">ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù ÙˆØªÙ†Ø¸ÙŠÙ… ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</p>
            </div>
            
            <div class="relative w-full md:w-96">
                <input type="text" id="searchInput" onkeyup="renderList()" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ø¯Ø±Ø³ Ø£Ùˆ Ù…Ø§Ø¯Ø©..." class="w-full bg-white dark:bg-dark-card border border-gray-200 dark:border-gray-700 rounded-xl py-3 pr-10 pl-4 focus:ring-2 focus:ring-brand outline-none dark:text-white shadow-sm transition-all">
                <i class="fas fa-search absolute right-3 top-3.5 text-gray-400"></i>
            </div>
        </header>

        <div class="bg-white dark:bg-dark-card rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-right whitespace-nowrap">
                    <thead class="bg-gray-50 dark:bg-slate-800 border-b border-gray-100 dark:border-gray-700">
                        <tr>
                            <th class="p-5 text-xs font-black text-gray-500 dark:text-gray-400">Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                            <th class="p-5 text-xs font-black text-gray-500 dark:text-gray-400">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³</th>
                            <th class="p-5 text-xs font-black text-gray-500 dark:text-gray-400">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
                            <th class="p-5 text-xs font-black text-gray-500 dark:text-gray-400">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</th>
                            <th class="p-5 text-xs font-black text-gray-500 dark:text-gray-400 text-center">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody" class="divide-y divide-gray-100 dark:divide-gray-700">
                        </tbody>
                </table>
            </div>
            
            <div id="noResults" class="hidden p-10 text-center text-gray-400">
                <i class="fas fa-search text-4xl mb-3 opacity-20"></i>
                <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±ÙˆØ³ ØªØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ</p>
            </div>
        </div>
    </main>

    <script>
        // === ÙƒÙˆØ¯ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„) ===
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (sidebar.classList.contains('translate-x-full')) {
                // ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                sidebar.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
            } else {
                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                sidebar.classList.add('translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => overlay.classList.add('hidden'), 300);
            }
        }

        // === ÙƒÙˆØ¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚ ===
        const DB_KEY = 'srs_pro_db_v1';
        const SETTINGS_KEY = 'srs_pro_settings_v1';
        let appData = { lessons: [] };

        function init() {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const d = localStorage.getItem(DB_KEY);
            if(d) appData = JSON.parse(d);
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
            const s = localStorage.getItem(SETTINGS_KEY);
            if(s && JSON.parse(s).darkMode) document.documentElement.classList.add('dark');

            renderList();
        }

        function renderList() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const tbody = document.getElementById('tableBody');
            const noRes = document.getElementById('noResults');
            
            tbody.innerHTML = '';
            
            // ÙÙ„ØªØ±Ø©
            const filtered = appData.lessons.filter(l => 
                l.title.toLowerCase().includes(search) || 
                l.subject.toLowerCase().includes(search)
            );
            // ØªØ±ØªÙŠØ¨ Ø¹ÙƒØ³ÙŠ (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
            filtered.reverse();

            if (filtered.length === 0) {
                noRes.classList.remove('hidden');
                return;
            } else {
                noRes.classList.add('hidden');
            }

            filtered.forEach(lesson => {
                const date = new Date(lesson.nextReview);
                const isOverdue = date < new Date();
                const dateStr = date.toLocaleDateString('ar-EG', {month:'short', day:'numeric'});
                
                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-50 dark:hover:bg-slate-800/50 transition group";
                tr.innerHTML = `
                    <td class="p-5">
                        <span class="bg-blue-50 dark:bg-blue-900/20 text-brand dark:text-blue-300 px-3 py-1 rounded-lg text-xs font-bold inline-block">
                            ${lesson.subject}
                        </span>
                    </td>
                    <td class="p-5 font-bold text-slate-800 dark:text-white text-sm md:text-base">
                        ${lesson.title}
                    </td>
                    <td class="p-5">
                        <div class="flex items-center gap-1">
                            ${getStars(lesson.layer)}
                        </div>
                    </td>
                    <td class="p-5 text-sm font-bold ${isOverdue ? 'text-red-500' : 'text-gray-500'}">
                        ${dateStr} ${isOverdue ? '<i class="fas fa-exclamation-circle ml-1"></i>' : ''}
                    </td>
                    <td class="p-5">
                        <div class="flex justify-center gap-2 md:opacity-0 group-hover:opacity-100 transition opacity-100">
                            <button onclick="editLesson(${lesson.id})" class="w-8 h-8 rounded-full bg-gray-100 dark:bg-slate-700 text-blue-500 hover:bg-blue-500 hover:text-white transition flex items-center justify-center shadow-sm">
                                <i class="fas fa-pen text-xs"></i>
                            </button>
                            <button onclick="deleteLesson(${lesson.id})" class="w-8 h-8 rounded-full bg-gray-100 dark:bg-slate-700 text-red-500 hover:bg-red-500 hover:text-white transition flex items-center justify-center shadow-sm">
                                <i class="fas fa-trash text-xs"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function getStars(level) {
            let html = '';
            for(let i=0; i<3; i++) {
                if(level > i*2) html += '<i class="fas fa-circle text-[8px] text-green-500"></i>';
                else html += '<i class="fas fa-circle text-[8px] text-gray-200 dark:text-gray-700"></i>';
            }
            return html;
        }

        // === ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø³ ===
        function editLesson(id) {
            const l = appData.lessons.find(x => x.id === id);
            if(!l) return;

            Swal.fire({
                title: 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø³',
                html: `
                    <div class="text-right space-y-3">
                        <div>
                            <label class="text-xs font-bold text-gray-500">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                            <input id="swal-subject" class="w-full p-2 border rounded-lg dark:bg-slate-800 dark:text-white dark:border-gray-600 outline-none focus:border-brand" value="${l.subject}">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                            <input id="swal-title" class="w-full p-2 border rounded-lg dark:bg-slate-800 dark:text-white dark:border-gray-600 outline-none focus:border-brand" value="${l.title}">
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Ø­ÙØ¸',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                confirmButtonColor: '#2563eb',
                preConfirm: () => {
                    const sub = document.getElementById('swal-subject').value;
                    const tit = document.getElementById('swal-title').value;
                    if(!sub || !tit) Swal.showValidationMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                    return { subject: sub, title: tit }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    l.subject = result.value.subject;
                    l.title = result.value.title;
                    saveAndRefresh();
                    Swal.fire({icon: 'success', title: 'ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„', timer: 1500, showConfirmButton: false});
                }
            });
        }

        // === Ø­Ø°Ù Ø§Ù„Ø¯Ø±Ø³ ===
        function deleteLesson(id) {
            Swal.fire({
                title: 'Ø­Ø°Ù Ø§Ù„Ø¯Ø±Ø³ØŸ',
                text: "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
            }).then((result) => {
                if (result.isConfirmed) {
                    appData.lessons = appData.lessons.filter(l => l.id !== id);
                    saveAndRefresh();
                    Swal.fire({icon: 'success', title: 'ØªÙ… Ø§Ù„Ø­Ø°Ù', timer: 1500, showConfirmButton: false});
                }
            });
        }

        function saveAndRefresh() {
            localStorage.setItem(DB_KEY, JSON.stringify(appData));
            renderList();
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        init();
    </script>
</body>
</html>